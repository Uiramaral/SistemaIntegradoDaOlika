<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@yield('title', 'Olika - Pães Artesanais | Cardápio Digital')</title>
    <meta name="description" content="@yield('description', 'Pães artesanais com fermentação natural. Peça online 24h por dia. Tradição e qualidade em cada fornada.')">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: 'hsl(28, 82%, 52%)',
                            foreground: '#fff',
                        },
                        background: 'hsl(35, 25%, 97%)',
                        foreground: 'hsl(25, 40%, 15%)',
                        card: '#fff',
                        muted: {
                            DEFAULT: 'hsl(30, 20%, 94%)',
                            foreground: 'hsl(25, 20%, 45%)',
                        },
                    },
                },
            },
        }
    </script>
    <style>
      :root{
        --brand-50:#f3eae3; --brand-100:#eadfd4; --brand-200:#dccab8; --brand-300:#c9af96;
        --brand-400:#a88060; --brand-500:#7A5230; --brand-600:#694625; --brand-700:#5E3E23; --brand-800:#4b3019; --brand-900:#3b2512;
      }
      /* Background overrides */
      .bg-orange-50{background-color:var(--brand-50)!important}
      .bg-orange-100{background-color:var(--brand-100)!important}
      .bg-orange-200{background-color:var(--brand-200)!important}
      .bg-orange-500{background-color:var(--brand-500)!important}
      .bg-orange-600{background-color:var(--brand-600)!important}
      .bg-orange-800{background-color:var(--brand-800)!important}
      .hover\:bg-orange-50:hover{background-color:var(--brand-50)!important}
      .hover\:bg-orange-100:hover{background-color:var(--brand-100)!important}
      .hover\:bg-orange-500:hover{background-color:var(--brand-500)!important}
      .hover\:bg-orange-600:hover{background-color:var(--brand-600)!important}
      /* Text overrides */
      .text-orange-500{color:var(--brand-500)!important}
      .text-orange-600{color:var(--brand-600)!important}
      /* Scrollbar hide */
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .text-orange-700{color:var(--brand-700)!important}
      .text-orange-800{color:var(--brand-800)!important}
      /* Border overrides */
      .border-orange-100{border-color:var(--brand-100)!important}
      .border-orange-200{border-color:var(--brand-200)!important}
      .border-orange-500{border-color:var(--brand-500)!important}
      /* Ring/focus (best-effort) */
      .focus\:ring-orange-500:focus{--tw-ring-color: var(--brand-500)!important}
      .focus\:ring-orange-600:focus{--tw-ring-color: var(--brand-600)!important}
      /* Gradients used como fallback de letra "O" já foram trocados no banner */
    </style>
    
    @stack('styles')
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body class="min-h-screen flex flex-col bg-gradient-to-b from-[#FFF8F0] to-white">
    <!-- Header / Branding -->
    @if(request()->routeIs('pedido.checkout*') || request()->routeIs('pedido.payment*'))
    @php
        $cartCount = session('cart_count', 0);
        $cart = session('cart', []);
        if (empty($cartCount) && !empty($cart)) { $cartCount = array_sum(array_column($cart, 'qty')); }
    @endphp
    <header class="w-full border-b bg-white shadow-sm sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-3 sm:px-4 h-14 sm:h-16 flex items-center justify-between">
            <a href="{{ route('pedido.index') }}" class="inline-flex items-center gap-1.5 sm:gap-2 flex-shrink-0 min-w-0">
                @php
                    $logoSquare = null;
                    if (\Storage::disk('public')->exists('uploads/branding/logo.png')) { $logoSquare = 'uploads/branding/logo.png'; }
                    elseif (\Storage::disk('public')->exists('uploads/branding/logo.jpg')) { $logoSquare = 'uploads/branding/logo.jpg'; }
                @endphp
                @if($logoSquare)
                    <img src="{{ asset('storage/'.$logoSquare) }}" alt="Olika" class="h-8 w-8 sm:h-10 sm:w-10 rounded-full object-cover flex-shrink-0">
                @else
                    <div class="h-8 w-8 sm:h-10 sm:w-10 rounded-full bg-orange-500 flex items-center justify-center flex-shrink-0">
                        <span class="text-lg sm:text-xl font-bold text-white">O</span>
                    </div>
                @endif
                <div class="flex flex-col min-w-0">
                    <span class="text-base sm:text-lg font-bold text-gray-900 leading-tight truncate">Olika</span>
                    <span class="text-xs text-gray-600 leading-tight truncate hidden sm:block">Pães Artesanais</span>
                </div>
            </a>
            <a href="{{ route('pedido.cart.index') }}" class="inline-flex items-center gap-1.5 sm:gap-2 text-gray-700 hover:text-orange-600 transition-colors relative flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0">
                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <path d="M16 10a4 4 0 0 1-8 0"></path>
                </svg>
                <span class="text-sm sm:text-base hidden sm:inline">Carrinho</span>
                @if($cartCount > 0)
                <div class="absolute -top-1 -right-1 h-5 w-5 bg-orange-500 text-white text-xs font-bold rounded-full flex items-center justify-center" id="cartBadgeHeader">
                    {{ $cartCount }}
                </div>
                @endif
            </a>
        </div>
    </header>
    @endif

    <!-- Hero Section (não exibir em checkout/payment) -->
    @if(!request()->routeIs('pedido.checkout*') && !request()->routeIs('pedido.payment*'))
    @php
        $bannerPath = null;
        if (Storage::disk('public')->exists('uploads/branding/banner.jpg')) {
            $bannerPath = 'uploads/branding/banner.jpg';
        } elseif (Storage::disk('public')->exists('uploads/branding/banner.png')) {
            $bannerPath = 'uploads/branding/banner.png';
        }
        // Logo horizontal prioritária
        $logoHorizPath = null;
        if (Storage::disk('public')->exists('uploads/branding/logo-horizontal.png')) { $logoHorizPath = 'uploads/branding/logo-horizontal.png'; }
        elseif (Storage::disk('public')->exists('uploads/branding/logo-horizontal.jpg')) { $logoHorizPath = 'uploads/branding/logo-horizontal.jpg'; }
        // Fallback para logo quadrada
        $logoPath = null;
        if (Storage::disk('public')->exists('uploads/branding/logo.png')) { $logoPath = 'uploads/branding/logo.png'; }
        elseif (Storage::disk('public')->exists('uploads/branding/logo.jpg')) { $logoPath = 'uploads/branding/logo.jpg'; }
        // Contagem do carrinho
        $cartCount = session('cart_count', 0);
        $cart = session('cart', []);
        if (empty($cartCount) && !empty($cart)) { $cartCount = array_sum(array_column($cart, 'qty')); }
    @endphp
    <div class="relative h-[200px] bg-gradient-to-r from-[#7A5230] to-[#5E3E23] flex items-center justify-center overflow-hidden">
        @if($bannerPath)
            <div class="absolute inset-0 bg-center bg-cover opacity-20" style="background-image: url('{{ asset('storage/'.$bannerPath) }}');"></div>
        @else
            <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1509440159596-0249088772ff?w=1200&auto=format&fit=crop')] bg-cover bg-center opacity-20"></div>
        @endif

        <!-- Carrinho no topo do banner - fixo durante scroll -->
        <a href="{{ route('pedido.cart.index') }}" class="fixed top-3 right-4 z-50 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors border border-white/30 bg-white/80 hover:bg-white h-10 w-10 shadow-sm backdrop-blur">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-[#5E3E23]">
                <circle cx="8" cy="21" r="1"></circle>
                <circle cx="19" cy="21" r="1"></circle>
                <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path>
            </svg>
            @if($cartCount > 0)
            <div class="absolute -right-2 -top-2 h-5 w-5 rounded-full bg-[#7A5230] text-white text-xs flex items-center justify-center font-semibold">
                {{ $cartCount }}
            </div>
            @endif
        </a>

        <div class="relative z-10 text-white">
            @php 
                // Preferir logo quadrada para compor com texto ao lado
                $logoSquare = null;
                if (Storage::disk('public')->exists('uploads/branding/logo.png')) { $logoSquare = 'uploads/branding/logo.png'; }
                elseif (Storage::disk('public')->exists('uploads/branding/logo.jpg')) { $logoSquare = 'uploads/branding/logo.jpg'; }
            @endphp
            <div class="mx-auto flex items-center justify-center gap-3">
                @if($logoSquare)
                    <div class="h-[80px] w-[80px] rounded-full overflow-hidden bg-white/90 shadow">
                        <img src="{{ asset('storage/'.$logoSquare) }}" alt="Olika" class="w-full h-full object-cover">
                    </div>
                @else
                    <div class="h-[80px] w-[80px] rounded-full bg-white/90 flex items-center justify-center shadow">
                        <span class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-[#7A5230] to-[#5E3E23] bg-clip-text text-transparent">O</span>
                    </div>
                @endif
                <div class="leading-tight text-center md:text-left">
                    <h1 class="text-3xl md:text-4xl font-bold drop-shadow">Olika</h1>
                    <p class="text-base md:text-lg drop-shadow">Pães Artesanais</p>
                </div>
            </div>
        </div>
    </div>
    @endif

    <!-- Main Content -->
    <main class="flex-1 container mx-auto px-4 py-8">
        @yield('content')
    </main>

    <script>
      // Atualiza a badge do carrinho globalmente
      window.updateCartBadge = function(count){
        // Badge no header do checkout
        const checkoutBadge = document.getElementById('cartBadgeHeader');
        if (checkoutBadge) {
          if ((count||0) > 0) {
            checkoutBadge.textContent = count;
            checkoutBadge.style.display = 'flex';
          } else {
            checkoutBadge.style.display = 'none';
          }
        }
        
        // Badge no carrinho do banner (outras páginas)
        const link = document.querySelector('a[href*="cart"]');
        if(!link) return;
        let badge = link.querySelector('.absolute');
        if((count||0) > 0){
          if(!badge){
            badge = document.createElement('div');
            badge.className = 'absolute -right-2 -top-2 h-5 w-5 rounded-full bg-[#7A5230] text-white text-xs flex items-center justify-center font-semibold';
            link.appendChild(badge);
          }
          badge.textContent = count;
        } else if(badge){ badge.remove(); }
      }
      async function refreshCartCount(){
        try{
          const res = await fetch('{{ route('pedido.cart.count') }}', {headers:{'Accept':'application/json','X-Requested-With':'XMLHttpRequest'}});
          const j = await res.json();
          if(j && (typeof j.count !== 'undefined')){ window.updateCartBadge(j.count); }
        }catch(_e){}
      }
      document.addEventListener('DOMContentLoaded', function(){
        refreshCartCount();
        setInterval(refreshCartCount, 5000);
      });
    </script>

    <!-- Footer -->
    <footer class="border-t bg-white mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                <div>
                    <div class="flex items-start gap-2 justify-center md:justify-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-orange-500 mt-1">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <div>
                            <h3 class="font-semibold mb-2">Horário de Funcionamento</h3>
                            <p class="text-sm text-gray-600">Seg-Sex: 7h - 19h</p>
                            <p class="text-sm text-gray-600">Sáb-Dom: 8h - 14h</p>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="flex items-start gap-2 justify-center md:justify-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-orange-500 mt-1">
                            <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <div>
                            <h3 class="font-semibold mb-2">Endereço</h3>
                            <p class="text-sm text-gray-600">Rua dos Pães Artesanais, 123</p>
                            <p class="text-sm text-gray-600">Bairro Gourmet - São Paulo, SP</p>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="flex items-start gap-2 justify-center md:justify-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-orange-500 mt-1">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        <div>
                            <h3 class="font-semibold mb-2">Contato</h3>
                            <p class="text-sm text-gray-600">(11) 98765-4321</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t text-center text-sm text-gray-600">
                <p>© {{ date('Y') }} Olika - Pães Artesanais. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    @stack('scripts')
</body>
</html>
